---
output: 
  github_document:
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: false
---

<!-- bench/bench.md is generated from bench/bench.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "bench/figures/bench-",
  out.width = "100%",
  fig.height = 6,
  code.fold = TRUE,
  collapse = TRUE
)

requireNamespace("bench")
requireNamespace("stringi")
requireNamespace("ggplot2")
requireNamespace("ggbeeswarm")
requireNamespace("gt")
```

```{r}
library(facts)
```

```{r}
# to save these
bench_env <- new.env()

do_bench <- function(
    unique_n = 10^(1:4), 
    values_n = 10^(2:6), 
    values_type = c("logical", "character", "double", "integer", "date")
) {
  values_type <- match.arg(values_type)
  
  if (values_type == "logical") {
    unique_n <- 3
  }
  
  res <- bench::press(
    un = unique_n,
    vn = values_n,
    {
      x <- switch(
        values_type,
        character = stringi::stri_rand_strings(un, 5),
        double = runif(un),
        integer = order(runif(un)),
        date = Sys.Date() + order(runif(un)),
        logical = c(TRUE, FALSE, NA)
      )
      x <- sample(x, vn, TRUE)
      bench::mark(
        factor = factor(x),
        fact = fact(x),
        check = FALSE
      )
    }
  )
  
  assign(values_type, res, envir = bench_env)
  
  print(bench:::autoplot.bench_mark(res) + ggplot2::theme(legend.position = "top"))
  
  writeLines('<details><summary>Show table</summary>')
  res[1:9] |>
    transform(expression = sapply(expression, deparse)) |>
    gt::gt("expression") |> 
    print()
  writeLines("</details>")
  
  invisible()
}
```

## Logical

Logical is much faster because we only have to check for 3 values

```{r bench-logical}
#| results: asis
#| fig-height: 2
do_bench(values_type = "logical")
```


## Character

```{r bench-characters}
#| results: asis
do_bench(values_type = "character")
```

## Doubles

```{r bench-doubles}
#| results: asis
do_bench(values_type = "double")
```

## Integers

```{r bench-integers}
#| results: asis
do_bench(values_type = "integer")
```

## Dates

```{r bench-dates}
#| results: asis
do_bench(values_type = "date")
```
